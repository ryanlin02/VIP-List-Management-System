<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP 來賓管理系統</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- 使用 Font Awesome 圖標 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ===== 變數定義：用於主題與多語言支援 ===== */
        :root {
            /* 顏色變數 */
            --color-primary: #3498db;
            --color-secondary: #2c3e50;
            --color-success: #2ecc71;
            --color-warning: #f39c12;
            --color-danger: #e74c3c;
            --color-info: #3498db;
            --color-light: #ecf0f1;
            --color-dark: #2c3e50;
            --color-white: #ffffff;
            --color-bg: #f8f9fa;
            --color-text: #333333;
            --color-border: #dee2e6;
            
            /* 字體變數 */
            --font-family: 'Arial', sans-serif;
            --font-size-small: 0.875rem;
            --font-size-normal: 1rem;
            --font-size-large: 1.25rem;
            --font-size-xlarge: 1.5rem;
            
            /* 間距變數 */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            
            /* 圓角變數 */
            --border-radius-sm: 0.25rem;
            --border-radius-md: 0.5rem;
            --border-radius-lg: 1rem;
            
            /* 陰影變數 */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
        }

        /* ===== 基本樣式 ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: var(--color-primary);
            color: var(--color-white);
            padding: var(--spacing-md);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        main {
            padding: var(--spacing-md);
            max-width: 100%;
            margin: 0 auto;
            min-height: calc(100vh - 120px);
        }

        footer {
            background-color: var(--color-secondary);
            color: var(--color-white);
            text-align: center;
            padding: var(--spacing-sm);
            font-size: var(--font-size-small);
        }

        /* ===== 導航樣式 ===== */
        nav {
            display: flex;
            justify-content: space-around;
            background-color: var(--color-secondary);
            padding: var(--spacing-sm) 0;
        }

        nav a {
            color: var(--color-white);
            text-decoration: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            transition: background-color 0.3s;
            font-size: var(--font-size-small);
        }

        nav a:hover, nav a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        nav i {
            margin-right: var(--spacing-xs);
        }

        /* ===== 卡片樣式 ===== */
        .card {
            background-color: var(--color-white);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-sm);
        }

        .card-title {
            font-size: var(--font-size-large);
            margin-bottom: var(--spacing-sm);
            color: var(--color-secondary);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--spacing-xs);
        }

        /* ===== 表單樣式 ===== */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: var(--spacing-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-normal);
        }

        button {
            background-color: var(--color-primary);
            color: var(--color-white);
            border: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: var(--font-size-normal);
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        button.secondary {
            background-color: var(--color-secondary);
        }

        button.secondary:hover {
            background-color: #1a252f;
        }

        button.success {
            background-color: var(--color-success);
        }

        button.warning {
            background-color: var(--color-warning);
        }

        button.danger {
            background-color: var(--color-danger);
        }

        /* ===== 列表樣式 ===== */
        .list {
            list-style: none;
            padding: 0;
        }

        .list-item {
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item-title {
            font-weight: bold;
        }

        .list-item-subtitle {
            font-size: var(--font-size-small);
            color: #6c757d;
        }

        /* ===== 狀態標記 ===== */
        .status {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-small);
            display: inline-block;
        }

        .status-pending {
            background-color: #e2e3e5;
            color: #383d41;
        }

        .status-checked-in {
            background-color: var(--color-success);
            color: white;
        }

        .status-introduced {
            background-color: #17a2b8;
            color: white;
        }

        .status-late {
            background-color: var(--color-warning);
            color: white;
        }

        .status-absent {
            background-color: var(--color-danger);
            color: white;
        }

        .status-represented {
            background-color: #6f42c1;
            color: white;
        }

        /* ===== 搜尋與過濾 ===== */
        .search-bar {
            display: flex;
            margin-bottom: var(--spacing-md);
        }

        .search-bar input {
            flex-grow: 1;
            margin-right: var(--spacing-sm);
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .filter-group select {
            flex-grow: 1;
        }

        /* ===== 操作按鈕 ===== */
        .action-buttons {
            display: flex;
            gap: var(--spacing-sm);
        }

        .action-button {
            background-color: transparent;
            border: none;
            color: var(--color-secondary);
            cursor: pointer;
        }

        .action-button:hover {
            color: var(--color-primary);
        }

        /* ===== 模態框樣式 ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: var(--color-white);
            margin: 15% auto;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-md);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .modal-title {
            font-size: var(--font-size-large);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: var(--font-size-xlarge);
            cursor: pointer;
            color: var(--color-secondary);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        /* ===== 頁面容器 ===== */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* ===== 響應式設計 ===== */
        @media (min-width: 768px) {
            main {
                max-width: 768px;
            }

            nav {
                justify-content: center;
                gap: var(--spacing-lg);
            }

            nav a {
                font-size: var(--font-size-normal);
            }
        }

        /* ===== 登錄頁面 ===== */
        .login-container {
            max-width: 400px;
            margin: 10% auto;
        }

        .login-container .card {
            padding: var(--spacing-lg);
        }

        .login-title {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            color: var(--color-secondary);
        }

        .demo-notice {
            text-align: center;
            margin-top: var(--spacing-md);
            font-size: var(--font-size-small);
            color: #6c757d;
        }

        /* 載入中指示器 */
        .loading {
            display: none;
            text-align: center;
            padding: var(--spacing-md);
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--color-primary);
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- 登錄頁面 -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="card">
                <h2 class="login-title">VIP 來賓管理系統</h2>
                <div class="form-group">
                    <label for="email">電子郵箱</label>
                    <input type="email" id="email" placeholder="請輸入電子郵箱">
                </div>
                <div class="form-group">
                    <label for="password">密碼</label>
                    <input type="password" id="password" placeholder="請輸入密碼">
                </div>
                <button id="login-btn" class="btn-block">登入</button>
                <p class="demo-notice">開發階段：點擊「登入」按鈕直接進入系統</p>
            </div>
        </div>
    </div>

    <!-- 應用主頁面 -->
    <div id="app-page" class="page">
        <header>
            <h1>VIP 來賓管理系統</h1>
        </header>

        <nav>
            <a href="#" class="nav-link active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i> 儀表板</a>
            <a href="#" class="nav-link" data-page="guests"><i class="fas fa-users"></i> 貴賓管理</a>
            <a href="#" class="nav-link" data-page="events"><i class="fas fa-calendar-alt"></i> 活動管理</a>
            <a href="#" class="nav-link" data-page="settings"><i class="fas fa-cog"></i> 設定</a>
        </nav>

        <main>
            <!-- 儀表板頁面 -->
            <div id="dashboard-page" class="page active">
                <div class="card">
                    <h2 class="card-title">儀表板</h2>
                    <p>歡迎使用 VIP 來賓管理系統</p>
                    <div class="form-group">
                        <label for="current-event">選擇當前活動</label>
                        <select id="current-event">
                            <option value="1">2023 年度企業研討會</option>
                            <option value="2">科技創新論壇</option>
                            <option value="3">產業合作交流會</option>
                        </select>
                    </div>
                    <button id="enter-event-btn">進入活動</button>
                </div>

                <div class="card">
                    <h2 class="card-title">活動摘要</h2>
                    <div class="stats">
                        <div>總貴賓數量：<span id="total-guests">0</span></div>
                        <div>已簽到：<span id="checked-in-guests">0</span></div>
                        <div>已介紹：<span id="introduced-guests">0</span></div>
                        <div>待處理：<span id="pending-guests">0</span></div>
                    </div>
                </div>
            </div>

            <!-- 貴賓管理頁面 -->
            <div id="guests-page" class="page">
                <div class="card">
                    <h2 class="card-title">貴賓管理</h2>
                    
                    <div class="search-bar">
                        <input type="text" id="search-guests" placeholder="搜尋貴賓">
                        <button id="add-guest-btn">新增</button>
                    </div>
                    
                    <div class="filter-group">
                        <select id="filter-status">
                            <option value="all">所有狀態</option>
                            <option value="pending">等待中</option>
                            <option value="checked-in">已簽到</option>
                            <option value="introduced">已介紹</option>
                            <option value="late">將晚到</option>
                            <option value="absent">不會出席</option>
                            <option value="represented">由代理出席</option>
                        </select>
                        
                        <select id="filter-category">
                            <option value="all">所有分類</option>
                            <option value="government">政府單位</option>
                            <option value="corporate">企業代表</option>
                            <option value="media">媒體</option>
                            <option value="partner">合作夥伴</option>
                        </select>
                    </div>
                    
                    <ul id="guest-list" class="list">
                        <!-- 示例貴賓項目 -->
                        <li class="list-item" data-id="1">
                            <div>
                                <div class="list-item-title">李大明</div>
                                <div class="list-item-subtitle">台灣科技公司 - 執行長</div>
                                <span class="status status-checked-in">已簽到</span>
                            </div>
                            <div class="action-buttons">
                                <button class="action-button" data-action="edit"><i class="fas fa-edit"></i></button>
                                <button class="action-button" data-action="update-status"><i class="fas fa-sync-alt"></i></button>
                            </div>
                        </li>
                        <li class="list-item" data-id="2">
                            <div>
                                <div class="list-item-title">王小華</div>
                                <div class="list-item-subtitle">政府經濟部 - 司長</div>
                                <span class="status status-pending">等待中</span>
                            </div>
                            <div class="action-buttons">
                                <button class="action-button" data-action="edit"><i class="fas fa-edit"></i></button>
                                <button class="action-button" data-action="update-status"><i class="fas fa-sync-alt"></i></button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 活動管理頁面 -->
            <div id="events-page" class="page">
                <div class="card">
                    <h2 class="card-title">活動管理</h2>
                    <button id="add-event-btn">新增活動</button>
                    
                    <ul id="event-list" class="list">
                        <!-- 示例活動項目 -->
                        <li class="list-item" data-id="1">
                            <div>
                                <div class="list-item-title">2023 年度企業研討會</div>
                                <div class="list-item-subtitle">2023/12/15 - 國際會議中心</div>
                            </div>
                            <div class="action-buttons">
                                <button class="action-button" data-action="edit-event"><i class="fas fa-edit"></i></button>
                                <button class="action-button" data-action="delete-event"><i class="fas fa-trash"></i></button>
                            </div>
                        </li>
                        <li class="list-item" data-id="2">
                            <div>
                                <div class="list-item-title">科技創新論壇</div>
                                <div class="list-item-subtitle">2023/11/20 - 科技大樓</div>
                            </div>
                            <div class="action-buttons">
                                <button class="action-button" data-action="edit-event"><i class="fas fa-edit"></i></button>
                                <button class="action-button" data-action="delete-event"><i class="fas fa-trash"></i></button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 設定頁面 -->
            <div id="settings-page" class="page">
                <div class="card">
                    <h2 class="card-title">系統設定</h2>
                    
                    <div class="form-group">
                        <label for="language">語言</label>
                        <select id="language">
                            <option value="zh-TW">繁體中文</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="theme">主題</label>
                        <select id="theme">
                            <option value="light">明亮</option>
                            <option value="dark">深色</option>
                        </select>
                    </div>
                    
                    <button id="save-settings-btn">儲存設定</button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">帳號資訊</h2>
                    <div class="user-info">
                        <p>用戶名：<span id="user-name">管理員</span></p>
                        <p>角色：<span id="user-role">系統管理員</span></p>
                    </div>
                    <button id="logout-btn" class="danger">登出</button>

                    <div class="form-group" style="margin-top: var(--spacing-md);">
                        <button id="register-user-btn" class="secondary">用戶註冊（開發中）</button>
                    </div>

                </div>
            </div>

            <!-- 載入中指示器 -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>載入中...</p>
            </div>
        </main>

        <footer>
            <p>&copy; 2023 VIP 來賓管理系統 - 開發版本</p>
        </footer>
    </div>

    <!-- 更新貴賓狀態模態框 -->
    <div id="update-status-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">更新貴賓狀態</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="guest-name-display">貴賓：<strong>李大明</strong></p>
                <div class="form-group">
                    <label for="guest-status">狀態</label>
                    <select id="guest-status">
                        <option value="pending">等待中</option>
                        <option value="checked-in">已簽到</option>
                        <option value="introduced">已介紹</option>
                        <option value="late">將晚到</option>
                        <option value="absent">不會出席</option>
                        <option value="represented">由代理出席</option>
                    </select>
                </div>
                <div id="proxy-fields" style="display: none;">
                    <div class="form-group">
                        <label for="proxy-name">代理人姓名</label>
                        <input type="text" id="proxy-name">
                    </div>
                    <div class="form-group">
                        <label for="proxy-title">代理人職稱</label>
                        <input type="text" id="proxy-title">
                    </div>
                </div>
                <div class="form-group">
                    <label for="status-note">備註</label>
                    <textarea id="status-note" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary close-modal-btn">取消</button>
                <button id="save-status-btn" class="success">儲存</button>
            </div>
        </div>
    </div>

    <!-- 編輯貴賓模態框 -->
    <div id="edit-guest-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">編輯貴賓資料</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-guest-name">姓名</label>
                    <input type="text" id="edit-guest-name">
                </div>
                <div class="form-group">
                    <label for="edit-guest-title">職稱</label>
                    <input type="text" id="edit-guest-title">
                </div>
                <div class="form-group">
                    <label for="edit-guest-organization">單位</label>
                    <input type="text" id="edit-guest-organization">
                </div>
                <div class="form-group">
                    <label for="edit-guest-category">分類</label>
                    <select id="edit-guest-category">
                        <option value="government">政府單位</option>
                        <option value="corporate">企業代表</option>
                        <option value="media">媒體</option>
                        <option value="partner">合作夥伴</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-guest-priority">優先順序</label>
                    <input type="number" id="edit-guest-priority" min="1" max="10">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary close-modal-btn">取消</button>
                <button id="save-guest-btn" class="success">儲存</button>
            </div>
        </div>
    </div>

    <script>
        // ===== Firebase 配置 =====
        const firebaseConfig = {
            apiKey: "AIzaSyDvL60JmAbzjDHeoIAduGyvmBsSQN5UElw",
            authDomain: "vip-list-management-system.firebaseapp.com",
            projectId: "vip-list-management-system",
            storageBucket: "vip-list-management-system.firebasestorage.app",
            messagingSenderId: "60059336895",
            appId: "1:60059336895:web:230a6e30326aef4388460a",
            measurementId: "G-9KWLGYMHE5"
        };
        
        // 初始化 Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // 啟用離線緩存
        database.ref('.info/connected').on('value', (snap) => {
            if (snap.val() === true) {
                console.log('已連接到 Firebase');
            } else {
                console.log('已斷開與 Firebase 的連接');
            }
        });

        // 設置離線持久化
        database.enablePersistence()
            .then(() => console.log('離線緩存已啟用'))
            .catch((err) => {
                if (err.code === 'failed-precondition') {
                    console.log('多個標籤頁開啟，離線緩存只能在一個標籤頁中啟用');
                } else if (err.code === 'unimplemented') {
                    console.log('當前瀏覽器不支持離線緩存');
                }
            });

        // ===== 全域變數 =====
        let currentUser = null;
        let currentEvent = null;
        let currentPage = 'dashboard';
        let guestsList = [];
        let eventsList = [];

        // ===== DOM 元素選擇器 =====
        const $ = (selector) => document.querySelector(selector);
        
        // ===== 頁面導航函數 =====
        function navigateTo(pageName) {
            // 隱藏所有頁面
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // 顯示所選頁面
            $(`#${pageName}-page`).classList.add('active');
            
            // 更新導航選中狀態
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const activeNavLink = document.querySelector(`.nav-link[data-page="${pageName}"]`);
            if (activeNavLink) {
                activeNavLink.classList.add('active');
            }
            
            currentPage = pageName;
        }

        // ===== 模態框函數 =====
        function openModal(modalId) {
            $(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            $(modalId).style.display = 'none';
        }

        // ===== 顯示載入中指示器 =====
        function showLoading() {
            $('#loading').style.display = 'block';
        }

        function hideLoading() {
            $('#loading').style.display = 'none';
        }

        // ===== 初始化應用 =====
        function initApp() {
            // 初始化 Firebase
            firebaseInit();
            
            // 註冊導航事件
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetPage = link.getAttribute('data-page');
                    navigateTo(targetPage);
                });
            });

            // 初始化模態框事件
            document.querySelectorAll('.close-modal, .close-modal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                });
            });

            // 登入按鈕事件
            $('#login-btn').addEventListener('click', () => {
                const email = $('#email').value;
                const password = $('#password').value;
                
                // 開發階段可以使用固定的測試帳號
                if (!email || !password) {
                    // 開發階段直接進入系統
                    $('#login-page').classList.remove('active');
                    $('#app-page').classList.add('active');
                    loadSampleData();
                    return;
                }
                
                firebaseLogin(email, password);
            });

            // 登出按鈕事件
            $('#logout-btn').addEventListener('click', () => {
                firebaseLogout();
            });

            // 更新狀態按鈕事件
            document.addEventListener('click', (e) => {
                const button = e.target.closest('[data-action="update-status"]');
                if (button) {
                    const listItem = button.closest('.list-item');
                    const guestId = listItem.getAttribute('data-id');
                    const guest = guestsList.find(g => g.id == guestId);
                    
                    if (guest) {
                        $('#guest-name-display').innerHTML = `貴賓：<strong>${guest.name}</strong>`;
                        $('#guest-status').value = guest.status || 'pending';
                        $('#status-note').value = guest.notes || '';
                        
                        if (guest.status === 'represented') {
                            $('#proxy-fields').style.display = 'block';
                            $('#proxy-name').value = guest.proxyName || '';
                            $('#proxy-title').value = guest.proxyTitle || '';
                        } else {
                            $('#proxy-fields').style.display = 'none';
                        }
                        
                        // 儲存當前編輯的貴賓ID
                        $('#update-status-modal').setAttribute('data-guest-id', guestId);
                        openModal('#update-status-modal');
                    }
                }
            });

            // 狀態變更時處理代理人欄位顯示
            $('#guest-status').addEventListener('change', () => {
                const status = $('#guest-status').value;
                $('#proxy-fields').style.display = status === 'represented' ? 'block' : 'none';
            });

            // 儲存狀態按鈕事件
            $('#save-status-btn').addEventListener('click', () => {
                const guestId = $('#update-status-modal').getAttribute('data-guest-id');
                const newStatus = $('#guest-status').value;
                const notes = $('#status-note').value;
                
                const additionalData = {
                    notes: notes
                };
                
                if (newStatus === 'represented') {
                    additionalData.proxyName = $('#proxy-name').value;
                    additionalData.proxyTitle = $('#proxy-title').value;
                }
                
                updateGuestStatus(guestId, newStatus, additionalData)
                    .then(() => {
                        closeModal('#update-status-modal');
                    });
            });

            // 編輯貴賓按鈕事件
            document.addEventListener('click', (e) => {
                const button = e.target.closest('[data-action="edit"]');
                if (button) {
                    const listItem = button.closest('.list-item');
                    const guestId = listItem.getAttribute('data-id');
                    const guest = guestsList.find(g => g.id == guestId);
                    
                    if (guest) {
                        $('#edit-guest-name').value = guest.name || '';
                        $('#edit-guest-title').value = guest.title || '';
                        $('#edit-guest-organization').value = guest.organization || '';
                        $('#edit-guest-category').value = guest.category || 'corporate';
                        $('#edit-guest-priority').value = guest.priority || 5;
                        
                        // 儲存當前編輯的貴賓ID
                        $('#edit-guest-modal').setAttribute('data-guest-id', guestId);
                        openModal('#edit-guest-modal');
                    }
                }
            });

            // 儲存貴賓資料按鈕事件
            $('#save-guest-btn').addEventListener('click', () => {
                const guestId = $('#edit-guest-modal').getAttribute('data-guest-id');
                const guestData = {
                    id: guestId,
                    name: $('#edit-guest-name').value,
                    title: $('#edit-guest-title').value,
                    organization: $('#edit-guest-organization').value,
                    category: $('#edit-guest-category').value,
                    priority: parseInt($('#edit-guest-priority').value) || 5
                };
                
                // 如果已有狀態，保留原狀態
                if (guestId) {
                    const existingGuest = guestsList.find(g => g.id == guestId);
                    if (existingGuest) {
                        guestData.status = existingGuest.status;
                        if (existingGuest.notes) guestData.notes = existingGuest.notes;
                        if (existingGuest.proxyName) guestData.proxyName = existingGuest.proxyName;
                        if (existingGuest.proxyTitle) guestData.proxyTitle = existingGuest.proxyTitle;
                    }
                } else {
                    guestData.status = 'pending';
                }
                
                saveGuest(guestData)
                    .then(() => {
                        closeModal('#edit-guest-modal');
                    });
            });

            // 新增貴賓按鈕事件
            $('#add-guest-btn').addEventListener('click', () => {
                // 清空表單
                $('#edit-guest-name').value = '';
                $('#edit-guest-title').value = '';
                $('#edit-guest-organization').value = '';
                $('#edit-guest-category').value = 'corporate';
                $('#edit-guest-priority').value = 5;
                
                // 清除ID
                $('#edit-guest-modal').removeAttribute('data-guest-id');
                openModal('#edit-guest-modal');
            });

            // 進入活動按鈕事件
            $('#enter-event-btn').addEventListener('click', () => {
                const eventId = $('#current-event').value;
                if (!eventId) {
                    alert("請選擇一個活動");
                    return;
                }
                
                currentEvent = eventId;
                setupGuestListeners(eventId); // 設置實時監聽
                navigateTo('guests');
            });

            // 搜尋貴賓事件
            $('#search-guests').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                filterGuests(searchTerm);
            });

            // 狀態過濾器事件
            $('#filter-status').addEventListener('change', () => {
                filterGuests($('#search-guests').value.toLowerCase());
            });

            // 分類過濾器事件
            $('#filter-category').addEventListener('change', () => {
                filterGuests($('#search-guests').value.toLowerCase());
            });

            // 新增活動按鈕事件
            $('#add-event-btn').addEventListener('click', () => {
                // 這裡需要一個新增活動的模態框
                // 暫時用 alert 替代
                const eventName = prompt("請輸入活動名稱:");
                if (eventName) {
                    const eventData = {
                        name: eventName,
                        date: new Date().toISOString(),
                        location: "待定",
                        status: "upcoming",
                        createdAt: new Date().toISOString()
                    };
                    
                    saveEvent(eventData);
                }
            });

            // 編輯活動按鈕事件
            document.addEventListener('click', (e) => {
                const button = e.target.closest('[data-action="edit-event"]');
                if (button) {
                    const listItem = button.closest('.list-item');
                    const eventId = listItem.getAttribute('data-id');
                    const event = eventsList.find(e => e.id == eventId);
                    
                    if (event) {
                        const eventName = prompt("請輸入活動名稱:", event.name);
                        if (eventName) {
                            event.name = eventName;
                            saveEvent(event);
                        }
                    }
                }
            });

            // 刪除活動按鈕事件
            document.addEventListener('click', (e) => {
                const button = e.target.closest('[data-action="delete-event"]');
                if (button) {
                    const listItem = button.closest('.list-item');
                    const eventId = listItem.getAttribute('data-id');
                    deleteEvent(eventId);
                }
            });

            // 儲存設定按鈕事件
            $('#save-settings-btn').addEventListener('click', () => {
                const language = $('#language').value;
                const theme = $('#theme').value;
                
                // 儲存到 localStorage
                localStorage.setItem('language', language);
                localStorage.setItem('theme', theme);
                
                // 切換主題
                if (theme === 'dark') {
                    applyDarkTheme();
                } else {
                    applyLightTheme();
                }
                
                alert("設定已儲存");
            });

            // 載入使用者設定
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                $('#theme').value = savedTheme;
                if (savedTheme === 'dark') {
                    applyDarkTheme();
                }
            }
            
            const savedLanguage = localStorage.getItem('language');
            if (savedLanguage) {
                $('#language').value = savedLanguage;
            }
        }

        // ===== 載入示例數據 =====
        function loadSampleData() {
            // 示例貴賓數據
            guestsList = [
                {
                    id: 1,
                    name: "李大明",
                    title: "執行長",
                    organization: "台灣科技公司",
                    category: "corporate",
                    priority: 1,
                    status: "checked-in",
                    lastUpdatedAt: "2023-11-01T08:30:00Z",
                    lastUpdatedBy: "工作人員A"
                },
                {
                    id: 2,
                    name: "王小華",
                    title: "司長",
                    organization: "政府經濟部",
                    category: "government",
                    priority: 2,
                    status: "pending",
                    lastUpdatedAt: "2023-11-01T08:00:00Z",
                    lastUpdatedBy: "系統管理員"
                },
                {
                    id: 3,
                    name: "張美麗",
                    title: "總編輯",
                    organization: "財經日報",
                    category: "media",
                    priority: 3,
                    status: "late",
                    notes: "預計14:30到場",
                    lastUpdatedAt: "2023-11-01T09:15:00Z",
                    lastUpdatedBy: "工作人員B"
                },
                {
                    id: 4,
                    name: "陳志明",
                    title: "總經理",
                    organization: "創新科技有限公司",
                    category: "partner",
                    priority: 4,
                    status: "represented",
                    proxyName: "林小明",
                    proxyTitle: "副總經理",
                    notes: "因緊急會議無法出席",
                    lastUpdatedAt: "2023-11-01T09:30:00Z",
                    lastUpdatedBy: "工作人員A"
                },
                {
                    id: 5,
                    name: "林大方",
                    title: "教授",
                    organization: "台灣大學",
                    category: "partner",
                    priority: 5,
                    status: "introduced",
                    lastUpdatedAt: "2023-11-01T10:15:00Z",
                    lastUpdatedBy: "主持人"
                }
            ];
            
            // 示例活動數據
            eventsList = [
                {
                    id: 1,
                    name: "2023 年度企業研討會",
                    date: "2023-12-15T09:00:00Z",
                    location: "國際會議中心",
                    status: "upcoming"
                },
                {
                    id: 2,
                    name: "科技創新論壇",
                    date: "2023-11-20T13:30:00Z",
                    location: "科技大樓",
                    status: "upcoming"
                },
                {
                    id: 3,
                    name: "產業合作交流會",
                    date: "2023-10-05T14:00:00Z",
                    location: "商業中心",
                    status: "completed"
                }
            ];
            
            // 更新界面顯示
            updateGuestsList();
            updateEventsList();
            updateDashboardStats();
        }

        // ===== 更新貴賓列表 =====
        function updateGuestsList() {
            const listElement = $('#guest-list');
            listElement.innerHTML = ''; // 清空列表
            
            // 狀態文字映射
            const statusText = {
                'pending': '等待中',
                'checked-in': '已簽到',
                'introduced': '已介紹',
                'late': '將晚到',
                'absent': '不會出席',
                'represented': '由代理出席'
            };
            
            guestsList.forEach(guest => {
                const listItem = document.createElement('li');
                listItem.className = 'list-item';
                listItem.setAttribute('data-id', guest.id);
                
                // 建立標記代理人的額外顯示
                let proxyInfo = '';
                if (guest.status === 'represented' && guest.proxyName) {
                    proxyInfo = `<div class="list-item-subtitle">代理人: ${guest.proxyName} (${guest.proxyTitle || ''})</div>`;
                }
                
                // 建立備註顯示
                let notesInfo = '';
                if (guest.notes) {
                    notesInfo = `<div class="list-item-notes">備註: ${guest.notes}</div>`;
                }
                
                listItem.innerHTML = `
                    <div>
                        <div class="list-item-title">${guest.name}</div>
                        <div class="list-item-subtitle">${guest.organization} - ${guest.title}</div>
                        <span class="status status-${guest.status}">${statusText[guest.status] || '未知'}</span>
                        ${proxyInfo}
                        ${notesInfo}
                    </div>
                    <div class="action-buttons">
                        <button class="action-button" data-action="edit"><i class="fas fa-edit"></i></button>
                        <button class="action-button" data-action="update-status"><i class="fas fa-sync-alt"></i></button>
                    </div>
                `;
                
                listElement.appendChild(listItem);
            });
        }

        // ===== 更新活動列表 =====
        function updateEventsList() {
            const listElement = $('#event-list');
            listElement.innerHTML = ''; // 清空列表
            
            eventsList.forEach(event => {
                const date = new Date(event.date);
                const formattedDate = `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}`;
                
                const listItem = document.createElement('li');
                listItem.className = 'list-item';
                listItem.setAttribute('data-id', event.id);
                
                listItem.innerHTML = `
                    <div>
                        <div class="list-item-title">${event.name}</div>
                        <div class="list-item-subtitle">${formattedDate} - ${event.location}</div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-button" data-action="edit-event"><i class="fas fa-edit"></i></button>
                        <button class="action-button" data-action="delete-event"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                listElement.appendChild(listItem);
            });
        }

        // ===== 更新儀表板統計 =====
        function updateDashboardStats() {
            $('#total-guests').textContent = guestsList.length;
            $('#checked-in-guests').textContent = guestsList.filter(g => g.status === 'checked-in' || g.status === 'introduced').length;
            $('#introduced-guests').textContent = guestsList.filter(g => g.status === 'introduced').length;
            $('#pending-guests').textContent = guestsList.filter(g => g.status === 'pending').length;
        }

        // ===== 過濾貴賓列表 =====
        function filterGuests(searchTerm) {
            const statusFilter = $('#filter-status').value;
            const categoryFilter = $('#filter-category').value;
            
            const listItems = document.querySelectorAll('#guest-list .list-item');
            
            listItems.forEach(item => {
                const guestId = item.getAttribute('data-id');
                const guest = guestsList.find(g => g.id == guestId);
                
                if (!guest) return;
                
                // 檢查搜尋詞
                const matchesSearch = searchTerm === '' || 
                    guest.name.toLowerCase().includes(searchTerm) || 
                    guest.organization.toLowerCase().includes(searchTerm) || 
                    guest.title.toLowerCase().includes(searchTerm);
                
                // 檢查狀態過濾器
                const matchesStatus = statusFilter === 'all' || guest.status === statusFilter;
                
                // 檢查分類過濾器
                const matchesCategory = categoryFilter === 'all' || guest.category === categoryFilter;
                
                // 顯示或隱藏項目
                if (matchesSearch && matchesStatus && matchesCategory) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ===== 主題切換函數 =====
        function applyDarkTheme() {
            document.documentElement.style.setProperty('--color-bg', '#1a1a1a');
            document.documentElement.style.setProperty('--color-text', '#f0f0f0');
            document.documentElement.style.setProperty('--color-white', '#2c2c2c');
            document.documentElement.style.setProperty('--color-border', '#444444');
        }

        function applyLightTheme() {
            document.documentElement.style.setProperty('--color-bg', '#f8f9fa');
            document.documentElement.style.setProperty('--color-text', '#333333');
            document.documentElement.style.setProperty('--color-white', '#ffffff');
            document.documentElement.style.setProperty('--color-border', '#dee2e6');
        }

        // ===== Firebase 相關函數 (開發階段未實際連接) =====
        // 這些函數會在實際連接 Firebase 時實現
        // ===== Firebase 相關函數 =====
        function firebaseInit() {
            // 監聽認證狀態
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    console.log("用戶已登入:", user.email);
                    $('#login-page').classList.remove('active');
                    $('#app-page').classList.add('active');
                    loadUserData();
                    loadEvents();

                    // 添加實時數據監聽
                    setupRealtimeListeners();
                } else {
                    console.log("用戶未登入");
                    $('#app-page').classList.remove('active');
                    $('#login-page').classList.add('active');
                    // 清除任何可能的實時監聽
                    clearRealtimeListeners();
                }
            });
        }

        // 建立實時數據監聽
        let activeListeners = [];

        function setupRealtimeListeners() {
            clearRealtimeListeners(); // 清除舊的監聽
            
            // 當前活動變更時，重新設置監聽
            $('#current-event').addEventListener('change', () => {
                const eventId = $('#current-event').value;
                if (eventId) {
                    currentEvent = eventId;
                    setupGuestListeners(eventId);
                }
            });
        }

        function setupGuestListeners(eventId) {
            if (!eventId) return;
            
            // 清除舊的貴賓監聽
            activeListeners.forEach(listener => {
                if (listener.type === 'guests') {
                    database.ref(listener.path).off('value', listener.callback);
                }
            });
            
            activeListeners = activeListeners.filter(listener => listener.type !== 'guests');
            
            // 設置新的貴賓監聽
            const guestsRef = database.ref(`guests/${eventId}`);
            const guestsCallback = guestsRef.on('value', (snapshot) => {
                guestsList = [];
                snapshot.forEach((childSnapshot) => {
                    const guest = childSnapshot.val();
                    guest.id = childSnapshot.key;
                    guestsList.push(guest);
                });
                
                updateGuestsList();
                updateDashboardStats();
            });
            
            activeListeners.push({
                type: 'guests',
                path: `guests/${eventId}`,
                callback: guestsCallback
            });
        }

        function clearRealtimeListeners() {
            activeListeners.forEach(listener => {
                database.ref(listener.path).off('value', listener.callback);
            });
            
            activeListeners = [];
        }

        function firebaseLogin(email, password) {
            showLoading();
            return auth.signInWithEmailAndPassword(email, password)
                .catch((error) => {
                    console.error("登入失敗:", error);
                    alert(`登入失敗: ${error.message}`);
                })
                .finally(() => {
                    hideLoading();
                });
        }

        function firebaseLogout() {
            return auth.signOut()
                .catch((error) => {
                    console.error("登出失敗:", error);
                });
        }

        function loadUserData() {
            const userId = currentUser.uid;
            return database.ref(`users/${userId}`).once('value')
                .then((snapshot) => {
                    const userData = snapshot.val();
                    if (userData) {
                        $('#user-name').textContent = userData.name || currentUser.email;
                        $('#user-role').textContent = userData.role || '一般使用者';
                    }
                })
                .catch((error) => {
                    console.error("載入用戶資料失敗:", error);
                });
        }

        // ===== 活動管理函數 =====
        function loadEvents() {
            showLoading();
            return database.ref('events').once('value')
                .then((snapshot) => {
                    eventsList = [];
                    snapshot.forEach((childSnapshot) => {
                        const event = childSnapshot.val();
                        event.id = childSnapshot.key;
                        eventsList.push(event);
                    });
                    
                    updateEventsList();
                    updateEventSelector();
                    hideLoading();
                })
                .catch((error) => {
                    console.error("載入活動失敗:", error);
                    hideLoading();
                });
        }

        function saveEvent(eventData) {
            showLoading();
            
            const eventRef = eventData.id 
                ? database.ref(`events/${eventData.id}`) 
                : database.ref('events').push();
            
            if (!eventData.id) {
                eventData.id = eventRef.key;
            }
            
            eventData.createdBy = currentUser.uid;
            eventData.updatedAt = new Date().toISOString();
            
            return eventRef.set(eventData)
                .then(() => {
                    console.log("活動儲存成功");
                    loadEvents();
                })
                .catch((error) => {
                    console.error("活動儲存失敗:", error);
                    alert(`儲存活動失敗: ${error.message}`);
                })
                .finally(() => {
                    hideLoading();
                });
        }

        function deleteEvent(eventId) {
            if (confirm("確定要刪除此活動嗎？此操作無法撤銷，且會刪除所有相關的貴賓資料！")) {
                showLoading();
                
                // 首先刪除貴賓資料
                database.ref(`guests/${eventId}`).remove()
                    .then(() => {
                        // 然後刪除活動本身
                        return database.ref(`events/${eventId}`).remove();
                    })
                    .then(() => {
                        console.log("活動刪除成功");
                        loadEvents();
                    })
                    .catch((error) => {
                        console.error("活動刪除失敗:", error);
                        alert(`刪除活動失敗: ${error.message}`);
                    })
                    .finally(() => {
                        hideLoading();
                    });
            }
        }

        // 更新活動選擇器
        function updateEventSelector() {
            const selector = $('#current-event');
            selector.innerHTML = '';
            
            if (eventsList.length === 0) {
                selector.innerHTML = '<option value="">尚無活動</option>';
                return;
            }
            
            eventsList.forEach(event => {
                const option = document.createElement('option');
                option.value = event.id;
                option.textContent = event.name;
                selector.appendChild(option);
            });
        }

        // ===== 貴賓管理函數 =====
        function loadGuests(eventId) {
            if (!eventId) {
                console.error("無法載入貴賓：未指定活動ID");
                return Promise.resolve();
            }
            
            currentEvent = eventId;
            showLoading();
            
            return database.ref(`guests/${eventId}`).once('value')
                .then((snapshot) => {
                    guestsList = [];
                    snapshot.forEach((childSnapshot) => {
                        const guest = childSnapshot.val();
                        guest.id = childSnapshot.key;
                        guestsList.push(guest);
                    });
                    
                    updateGuestsList();
                    updateDashboardStats();
                    hideLoading();
                })
                .catch((error) => {
                    console.error("載入貴賓失敗:", error);
                    hideLoading();
                });
        }

        function saveGuest(guestData) {
            if (!currentEvent) {
                alert("請先選擇一個活動");
                return Promise.reject(new Error("未選擇活動"));
            }
            
            showLoading();
            
            const guestRef = guestData.id 
                ? database.ref(`guests/${currentEvent}/${guestData.id}`) 
                : database.ref(`guests/${currentEvent}`).push();
            
            if (!guestData.id) {
                guestData.id = guestRef.key;
            }
            
            guestData.lastUpdatedBy = currentUser.uid;
            guestData.lastUpdatedAt = new Date().toISOString();
            
            return guestRef.set(guestData)
                .then(() => {
                    console.log("貴賓資料儲存成功");
                    loadGuests(currentEvent);
                    return logAction(currentEvent, {
                        action: guestData.id ? "update_guest" : "add_guest",
                        guestId: guestData.id,
                        message: `${guestData.id ? '更新' : '新增'}貴賓: ${guestData.name}`,
                        performedBy: currentUser.uid
                    });
                })
                .catch((error) => {
                    console.error("貴賓資料儲存失敗:", error);
                    alert(`儲存貴賓資料失敗: ${error.message}`);
                })
                .finally(() => {
                    hideLoading();
                });
        }

        function updateGuestStatus(guestId, newStatus, additionalData = {}) {
            if (!currentEvent || !guestId) {
                return Promise.reject(new Error("缺少必要參數"));
            }
            
            showLoading();
            
            const updates = {
                status: newStatus,
                lastUpdatedBy: currentUser.uid,
                lastUpdatedAt: new Date().toISOString(),
                ...additionalData
            };
            
            return database.ref(`guests/${currentEvent}/${guestId}`).update(updates)
                .then(() => {
                    console.log(`貴賓狀態已更新為: ${newStatus}`);
                    loadGuests(currentEvent);
                    
                    const guest = guestsList.find(g => g.id === guestId);
                    const guestName = guest ? guest.name : guestId;
                    
                    return logAction(currentEvent, {
                        action: "update_status",
                        guestId: guestId,
                        message: `更新貴賓 "${guestName}" 狀態為: ${newStatus}`,
                        performedBy: currentUser.uid,
                        previousValue: guest ? guest.status : null
                    });
                })
                .catch((error) => {
                    console.error("更新貴賓狀態失敗:", error);
                    alert(`更新狀態失敗: ${error.message}`);
                })
                .finally(() => {
                    hideLoading();
                });
        }

        // 記錄操作日誌
        function logAction(eventId, logData) {
            logData.timestamp = new Date().toISOString();
            return database.ref(`logs/${eventId}`).push().set(logData)
                .catch((error) => {
                    console.error("記錄操作失敗:", error);
                });
        }

        // 批量上傳貴賓
        function batchUploadGuests(eventId, guestsData) {
            if (!eventId || !guestsData || !Array.isArray(guestsData)) {
                return Promise.reject(new Error("參數無效"));
            }
            
            showLoading();
            const updates = {};
            
            guestsData.forEach(guest => {
                const guestId = database.ref(`guests/${eventId}`).push().key;
                guest.lastUpdatedBy = currentUser.uid;
                guest.lastUpdatedAt = new Date().toISOString();
                guest.status = guest.status || "pending";
                updates[`guests/${eventId}/${guestId}`] = guest;
            });
            
            return database.ref().update(updates)
                .then(() => {
                    console.log(`成功批量上傳 ${guestsData.length} 位貴賓`);
                    loadGuests(eventId);
                    return logAction(eventId, {
                        action: "batch_upload",
                        message: `批量上傳 ${guestsData.length} 位貴賓`,
                        performedBy: currentUser.uid
                    });
                })
                .catch((error) => {
                    console.error("批量上傳失敗:", error);
                    alert(`批量上傳失敗: ${error.message}`);
                })
                .finally(() => {
                    hideLoading();
                });
        }

        // ===== 文檔載入完成後初始化應用 =====
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

    <!-- 批量上傳貴賓模態框 -->
    <div id="batch-upload-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">批量上傳貴賓</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>請輸入貴賓資料，每行一位貴賓，格式為：姓名,職稱,單位,分類,優先順序</p>
                <p>例如：張三,總經理,ABC公司,corporate,1</p>
                <div class="form-group">
                    <textarea id="batch-guests-data" rows="10" placeholder="請輸入貴賓資料..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary close-modal-btn">取消</button>
                <button id="batch-upload-btn" class="success">上傳</button>
            </div>
        </div>
    </div>

    <script>
        // 批量上傳按鈕事件處理
        document.addEventListener('DOMContentLoaded', () => {
            // 添加批量上傳按鈕到貴賓管理頁面
            const addBatchUploadBtn = document.createElement('button');
            addBatchUploadBtn.id = 'open-batch-upload-btn';
            addBatchUploadBtn.textContent = '批量上傳';
            addBatchUploadBtn.className = 'secondary';
            addBatchUploadBtn.style.marginLeft = '8px';
            $('#add-guest-btn').after(addBatchUploadBtn);
        
            // 開啟批量上傳模態框
            $('#open-batch-upload-btn').addEventListener('click', () => {
                openModal('#batch-upload-modal');
            });
        
            // 處理批量上傳
            $('#batch-upload-btn').addEventListener('click', () => {
                const data = $('#batch-guests-data').value;
                if (!data.trim()) {
                    alert('請輸入貴賓資料');
                    return;
                }
        
                if (!currentEvent) {
                    alert('請先選擇一個活動');
                    closeModal('#batch-upload-modal');
                    return;
                }
        
                const lines = data.split('\n').filter(line => line.trim());
                const guestsData = [];
        
                for (const line of lines) {
                    const [name, title, organization, category, priority] = line.split(',').map(item => item.trim());
                    if (name) {
                        guestsData.push({
                            name,
                            title: title || '',
                            organization: organization || '',
                            category: category || 'corporate',
                            priority: parseInt(priority) || 5,
                            status: 'pending'
                        });
                    }
                }
        
                if (guestsData.length > 0) {
                    batchUploadGuests(currentEvent, guestsData)
                        .then(() => {
                            $('#batch-guests-data').value = '';
                            closeModal('#batch-upload-modal');
                        });
                } else {
                    alert('未能解析任何有效的貴賓資料');
                }
            });
        });
    </script>

</body>
</html>
